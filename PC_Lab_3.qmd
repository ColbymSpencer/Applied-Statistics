---
title: "PC_Lab_3"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r setup}
library(tidyverse)
library(readr)
```

## Exercise 1.1.

Ash dieback is a fungal disease that has wrecked havoc among European ash trees, Fraxinus exelcior. This tree is economically quite important, as it strong but flexible wood is used in many applications. About 5% of the population however has a genetic mutation that makes them resistant to the fungal disease. A farmer planted 80 trees and is now worried.

```{r}
n = 80 #number of trees
pr = 0.05 #probability that a tree is resistant
```

1.  What is the average amount of trees he can expect to lose to the disease? (Tip: look up how to calculate the average of the binomial distribution).

''' If a tree not resistant, we assume a 100% mortality, else the tree will live '''

```{r}
n*(1-pr)
```

2.  What is the probability that at least 5 trees survive?

```{r}
1-pbinom(4, n, pr)
```

3.  What is the probability that no more than 3 trees survive?

```{r}
pbinom(3, n, pr)
```

4.  What is the probability that no tree survives?

```{r}
dbinom(0,n,pr)
```

5.  You make an important assumption while doing these calculations. Which one is that, and does it make sense to make that assumption here?

```         
- the fungal disesase is 100% fatal and that trees with resistance have 100% survival rate.
- the model is the distribution
- the trees being resistant are independent events
```

## Exercise 1.2.

Assume that the distribution of IQ scores in the Belgian population can be described by a normal distribution with a population mean ùúá = 100 and a standard deviation ùúé = 13. You may assume that IQ scores are approximately continuous.

```{r}
mean <- 100
sd <- 13
```

1.  What percentage of the Belgian population has an IQ less than 90?

```{r}
pnorm(90, mean, sd)
```

2.  What percentage of the Belgian population has an IQ greater than 133?

```{r}
1-pnorm(133, mean, sd)
pnorm(133, mean, sd, lower.tail = FALSE)
```

3.  Between which two IQ scores does the IQ of the middle 80% of the population lie?

```{r}
qnorm(0.10, mean, sd)
qnorm(0.90, mean, sd)
```

4.  You meet a student in a caf√© who claims to have an IQ of 150. Do you think that student is lying? Justify your answer.

```{r}
1-pnorm(150,mean, sd)
pnorm(150,mean, sd, lower.tail = FALSE)
```

BONUS: probability of someone having a low iq with the same probability

```{r}
prob <- pnorm(150,mean, sd, lower.tail = FALSE)
qnorm(prob, mean, sd)
```

## Exercise 1.3.

### NO2 Dataset Metadata

In April 2017, the city council of Ghent introduced a new plan for traÔ¨Äic flow in the city. The next year the Flemish Environment Agency (Vlaamse Milieu Maatschappij or VMM) indeed found that the amount of nitrogen dioxide had seriously decreased. They measured the amount of ùëÅùëÇ 2 (in ùúáùëî/ùëö 3 ) in April 2017 and April 2018 at all 70 air quality measurement points in Ghent. The data contains the following variables: - street: indicates the street where the measuring device is located. - NO2_2017: indicates the average ùëÅùëÇ 2 concentration in April 2017 for that measurement point. - NO2_2018: indicates the average ùëÅùëÇ 2 concentration in April 2018 for that measurement point.

```{r}
no2 <- read_csv("Data/NO2_gent.csv")
```

### Abalone Dataset Metadata

The next dataset originates from a study conducted in 1994 by the marine lab of Warwick Nash. They studied various characteristics of abalones (shellfish) in Tasmania, and used this dataset to investigate whether the age of an abalone can also be accurately predicted based on other body measurements instead of the time-consuming procedure of counting the number of growth rings 1 . The abalone dataset used in this lab contains the following variables 2 : - sex: indicates the sex of the abalones (M, F, and I (infant)). - length: the length of the longest shell (mm). - diameter: the diameter perpendicular to the length (mm). - height: the height of the whole abalone (mm). - weight.whole: the weight of the whole abalone (g). - weight.shucked: the weight of the meat (g). - weight.viscera: the weight of the viscera (g). - weight.shell: the weight of the shell after drying (g). - rings: indicates the age.

```{r}
abalone <- read_csv("Data/abalone.csv")
```

1.  Do these two datasets describe a population or a sample?

```         
the NO2 dataset could be a sample or a population depending on what we are studying. For example, it could be a population for regulatory purposes.

The abalone dataset is a sample. The population it samples could be defined in different ways - for example, all the abalones in Tasmania, all the abalones in the region they were collected, etc.
```

2.  If the dataset describes a sample, what is the corresponding population?

```         
NO2: the distribution of NO2 in Ghent
Abalone: All the abalones in tasmania in 1994, the region in 1994, the region, etc. Keep in mind that samples are temporal and they may not be representative at futher dates. In this case environmental conditions may have changed.
```

3.  If the dataset describes a sample, determine the sample size.

```{r}
nrow(no2)
nrow(abalone)
```

```         
NO2 has 70 samples per year, totalling 140 samples over the two years.
Abalone sampled 4177 abalones.
```

## Exercise 1.4.

### 1. Examine the distribution of the variable weight.whole using a histogram and a QQ plot. Do you think this variable follows a normal distribution?

```{r}
# Histogram
ggplot(data = abalone) +
  geom_histogram(aes(x = weight.whole), bins = 20)

# Q-Q Plot 
ggplot(data = abalone, aes(sample = weight.whole)) +
  geom_qq() + geom_qq_line()
```

```         
the distribution of the histogram appears skewed right. The qq plot deviates from the qqline indicating a non-normal distribution.
```

### 2. Repeat this for the variable rings from the abalone dataset and evaluate the distribution. What do you notice about the graphs?

```{r}
# Histogram
ggplot(data = abalone) +
  geom_histogram(aes(x = rings), binwidth = 2)

# Q-Q Plot 
ggplot(data = abalone, aes(sample = rings)) +
  geom_qq() + geom_qq_line()
```

```         
The histogram appears roughly normal. The qq plot shows a noticable difference from the qq-line around x=1.5
```

## Exercise 1.5.

You can create a variable `isinfant` that has a 1 for an infant abalone and a 0 otherwise with the following code:

```{r}
abalone$isinfant <- abalone$sex == "I"
```

Adapt the code in the previous two blocks to solve the following questions: \### 1. Create the distribution of the sample estimate for the proportion of infants in the population if you take a sample of 50 animals. What do you see compared to the estimates for $\pi_{old}$?

```{r}
sample_size = 50

simulation <- replicate(5000, {
  sample_data <- sample(abalone$isinfant, sample_size)
  mean(sample_data)
})

simul_df <- data.frame(simulation)

ggplot(data = simul_df, aes(x=simulation)) +
  geom_histogram()
```

### 2.

Do the same, but now for a sample of 150 animals. What do you notice?

```{r}
sample_size = 150

simulation <- replicate(5000, {
  sample_data <- sample(abalone$isinfant, sample_size)
  mean(sample_data)
})

simul_df <- data.frame(simulation)

ggplot(data = simul_df, aes(x=simulation)) +
  geom_histogram()
```

### 3. Confidence Interval (sample distribution)

The simulated estimates for the proportion allow you to construct a 90% confidence interval. Calculate the values between which 90% of the simulated estimates lie. This gives you a 90% confidence interval around the proportion of infants in the population.

```{r}
quantile(simulation, probs = c(0.05,0.95))
```

### 4. Confidence Interval (normal distribution)

You‚Äôve seen in the theory that you can approach the exact distribution with the normal distribution if the sample size is large enough. Use this to calculate a 90% confidence interval around the proportion of infants.

```{r}
mean <- mean(simulation)
sd <- sd(simulation)
qnorm(.05, mean, sd)
qnorm(.95, mean, sd)
```

## Exercise 1.6.

1.  Run the simulation for the variable weight.whole and inspect the distribution of the simulated means using a histogram and QQ plot. What do you observe?

```{r}
# run simulation
sample_size = 150
variable = abalone$weight.whole

simulation <- replicate(5000, {
  sample_data <- sample(variable, sample_size)
  mean(sample_data)
})

simul_df <- data.frame(simulation)

ggplot(data = simul_df, aes(x=simulation)) +
  geom_histogram()
ggplot(data = simul_df, aes(sample=simulation)) +
  geom_qq() + geom_qq_line()
```

2.  Perform the simulation for the variable rings for different sample sizes. Take sample sizes of 10, 20, 50, and 100. Each time, examine the distribution of the sample means. What do you notice?

```{r custom function}
# custom simulation function

simulate <- function(sample_size, variable) {
  simulation <- replicate(5000, {
    sample_data <- sample(variable, sample_size)
    mean(sample_data)
  })
  
  simul_df <- data.frame(simulation)
  
  ggplot(data = simul_df, aes(x = simulation)) +
    geom_histogram()
  ggplot(data = simul_df, aes(sample = simulation)) +
    geom_qq() + geom_qq_line()
}

```

```{r}
simulate(10, abalone$rings)
simulate(20, abalone$rings)
simulate(40, abalone$rings)
simulate(100, abalone$rings)

#bonus
simulate(300, abalone$rings)
```

## Exercise 1.7.

### 1. Take a sample of ùëõ = 40 from the abalone dataset and calculate the sample mean for the variable weight.whole.

```{r}
sample_mean <- mean(sample(abalone$weight.whole,40))
```

### 2. Calculate the probability of obtaining a sample mean ÃÑ ùëã that is as large or larger than the sample mean you calculated. Remember, since you have the entire population, you can calculate ùúá and ùúé to standardize the distribution. Then, use the cumulative probability function of the standard normal distribution to solve this problem.

```{r}

```

### 3. Take a sample of ùëõ = 50 from the abalone dataset and calculate the sample mean and standard deviation for the variable rings. Suppose you don‚Äôt know the population mean ùúá, but you believe it‚Äôs 8. Since you also don‚Äôt know ùúé, use the sample standard deviation as an estimate for ùúé. What is the probability of getting a sample mean that is as far or farther from 8, assuming the true population mean is 8?

```{r}

```

### 4. Based on your previous result, do you think the sample mean is likely to be 8?

```{r}

```

## Exercise 1.8.

For all exercises where the NO 2 dataset is used, you may assume that the NO 2 values in Ghent follow a normal distribution. \### 1. The mayor claims that the average NO 2 concentration in 2017 was no higher than 41 ùúáùëî/ùëö 3 . If that were true, what is the probability of observing the measured sample mean or a more extreme one?

```{r}

```

### 2. Calculate the difference in NO 2 between 2017 and 2018 for each street in the dataset. What distribution does this difference follow?

```{r}

```

### 3. Calculate an interval for which you are 90% confident that it includes the (unknown) population mean difference.

```{r}

```

### 4. Bonus: Consider the data in the dataset as the entire population. Run a simulation where you randomly select 15 differences from the data 5000 times, and calculate the interval from the previous question. For each of these intervals, check whether it contains the population mean difference. Then, calculate the proportion of intervals that do.
